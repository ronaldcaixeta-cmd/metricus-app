<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Metricus V2– Conectar Google Ads</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans;
         margin:40px;line-height:1.5;max-width:720px}
    button{padding:12px 18px;font-size:16px;border-radius:10px;border:0;background:#2563eb;color:#fff;cursor:pointer}
    .log{background:#0b1220;color:#d1e0ff;padding:12px;border-radius:8px;white-space:pre-wrap}
  </style>
</head>
<body>
  <h2>Conectar Google Ads</h2>
  <p>Use o botão abaixo para iniciar o fluxo OAuth. Esta é uma página de teste só para completar a integração.</p>
  <button id="btn">Conectar com Google Ads</button>

  <h3>Logs</h3>
  <div id="logs" class="log"></div>

  <script>
    const log = (m) => {
      const el = document.getElementById('logs');
      el.textContent += (m + "\n");
    };

    // ✅ estes valores podem ficar públicos (NÃO incluir client_secret aqui)
    const CLIENT_ID  = "768885244063-m0trkfnu3q5oe5g991fql8dumcfaqsgv.apps.googleusercontent.com";
    const REDIRECT   = "https://preview--metricus-ia.lovable.app/oauth-callback";

    // Para teste: mesmo user_id/client_id que usamos antes
    const STATE = btoa(JSON.stringify({
      user_id:  "f40af188-1116-4123-8eb3-9294ef4c22f2",
      client_id:"default"
    }));

    const SCOPE = "https://www.googleapis.com/auth/adwords";

    document.getElementById('btn').addEventListener('click', () => {
      const url =
        "https://accounts.google.com/o/oauth2/v2/auth"
        + "?client_id=" + encodeURIComponent(CLIENT_ID)
        + "&redirect_uri=" + encodeURIComponent(REDIRECT)
        + "&scope=" + encodeURIComponent(SCOPE)
        + "&response_type=code"
        + "&state=" + encodeURIComponent(STATE)
        + "&access_type=offline"
        + "&prompt=consent";

      log("Abrindo Google OAuth…");
      const popup = window.open(url, "google-oauth", "width=520,height=650");
      if (!popup) {
        alert("Não foi possível abrir o popup. Desative o bloqueador de pop-ups.");
      }
    });

    // Recebe a mensagem do oauth-callback
    window.addEventListener("message", (ev) => {
      if (ev.origin !== window.location.origin) return;
      log("Mensagem recebida do callback: " + JSON.stringify(ev.data));
      if (ev.data?.type === "OAUTH_SUCCESS") {
        alert("✅ Conectado! Conta: " + (ev.data.account_name || "Google Ads"));
      } else if (ev.data?.type === "OAUTH_ERROR") {
        alert("❌ Erro na autenticação: " + ev.data.error);
      }
    });
  </script>
</body>
</html>
